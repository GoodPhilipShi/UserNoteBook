- æ›´æ–°ç‰ˆæœ¬: V1.7.1
- æ›´æ–°å¹³å°: é¾™èŠ¯

> ç”¨æˆ·åï¼šloongson
> 
> å¯†ç ï¼šloongson
> 
> ç”¨æˆ·åï¼šroot
> 
> å¯†ç ï¼šloongson

# ç¯å¢ƒ

## node ç‰ˆæœ¬

V12.16.3

## npm ç‰ˆæœ¬

V6.14.4

## Git ç‰ˆæœ¬

V2.20.1

# é€‚é…æµç¨‹

1. åˆ›å»ºå½“å‰æ¶æ„çš„æ–‡ä»¶å¤¹mips64
   
   1. å¤åˆ¶å…¶ä»–å…¼å®¹æ–‡ä»¶å¤¹ä¸­çš„node-pty-prebuilt-multiarchã€serialport
      
      1. é‡æ–°ç¼–è¯‘
      
      2. å®‰è£… electron-rebuild
         
         ```
         npm i electron-rebuild
         ```
      
      3. ç¼–è¯‘ serialport
         
         ```
         cd ./compat/mips64/serialport/node_modules/@serialport/bindings
         # æ–¹æ³•1
         ## electron-rebuildè·¯å¾„ -v electronç‰ˆæœ¬ -a æ¶æ„
         ../../../../../node_modules/.bin/electron-rebuild -v 6.1.7 -a mips64
         ```
   
   2. ç¼–è¯‘ node-pty-prebuilt-multiarch
      
      > æ–¹æ³•åŒä¸Š
      
      > ps: å‡ºç°ä»»ä½•é—®é¢˜ï¼Œå»ºè®®ç›´æ¥åˆ é™¤node_modules
      > å› ä¸ºä¸¤ä¸ªåŒ…çš„node_moduleséƒ½ä¸å¤š, å¯ä»¥å°½æƒ…çš„åˆ 

2. åˆ›å»º pack_mips64.json

```diff
  {
-    "build": {....},
+    "build":"",
+    "scripts": {
      "pack": "node ./compat/pack/myBeforeBuild.js && electron-packager . mindPlus --platform linux --arch mips64el --out ./scratch/ --electron-zip-dir=/home/loongson/.cache/electron/ && node ./compat/pack/afterSign.js && electron-installer-debian --src scratch/mindPlus-linux-mips64el/ --arch mips64el --config config.json"
    }
  }
```

> å¦å¤– `package.json` ä¸­çš„ `"postinstall": "electron-builder install-app-deps"` åˆ é™¤
> å› ä¸ºæ‰“åŒ…ä¸ä¼šä½¿ç”¨åˆ°`electron-builder `, ä½†æ˜¯`npm i`çš„æ—¶å€™ä¼šå»è¿è¡Œ`npm postinstall`

3. ä¿®æ”¹ setup.py

```diff
  if machine == 'aarch64':
      sourceFile = "./compat/aarch64"
+ elif machine == 'mips64':
+     sourceFile = "./compat/mips64"
+     print("[Change] main.js")
+     os.system(f"rm -rf ./main.js && cp {sourceFile}/main.js ./")
+     print("[+] cp config.json --> ./config.json")
+     os.system(f"cp -rf {sourceFile}/config.json ./")
+     print("[+] cp favicons --> ./favicons")
+     os.system(f"cp -rf {sourceFile}/favicons ./")
  else:
      sourceFile = "./compat/x86_64"
  ......
  ......
- machines = ["x86_64",'aarch64']
+ machines = ["x86_64",'aarch64','mips64']
```

4. ä¿®æ”¹ main.js

```diff
  webPreferences: {
+        nodeIntegration: true,
         nodeIntegrationInWorker: true,
+        enableRemoteModule: true
  }
```

5. æ·»åŠ  Python3.6.5_linux_mips64.zip
   
   > å¯ä»¥éšä¾¿å¤åˆ¶ä¸€ä¸ªï¼Œæ”¹ä¸ªå

## è¿˜å­˜åœ¨äºå†å²è®°å½•ä¸­çš„é—®é¢˜

### Uncaught ReferenceError: require is not defined at render.js

> [electron v12.0.0: Uncaught ReferenceError: require is not defined å·²è®¾ç½®nodeIntegration: true_baneryeçš„åšå®¢-CSDNåšå®¢](https://blog.csdn.net/banerye/article/details/114383977)

1. åœ¨ electron çš„ main.js çš„ webPreferences æ·»åŠ ä¸‹è¿°ä»£ç 
   
   ```
    mainWindow = new BrowserWindow({
         width: 1400,
         height: 900,
         show: false,
         webPreferences: {
    +        nodeIntegration: true,
         }
     });
   ```
   
   ### æˆ‘ä¹Ÿä¸æ˜¯å¾ˆæ¸…æ¥šçš„é—®é¢˜

2. ç¼–è¯‘node-pty-prebuilt-multiarch
   
   1. [electron v12.0.0: Uncaught ReferenceError: require is not defined å·²è®¾ç½®nodeIntegration: true_baneryeçš„åšå®¢-CSDNåšå®¢](https://www.cnblogs.com/yoshi/p/13531258.html)
   2. [Native Node Modules | Electron](https://www.electronjs.org/docs/latest/tutorial/using-native-node-modules)
   3. [Native Node Modules | Electron](https://npmmirror.com/package/node-pty-prebuilt-multiarch)
   4. [GitHub - oznu/node-pty-prebuilt-multiarch: A parallel fork of node-pty providing ia32, amd64, arm, and aarch64 prebuilt packages for macOS, Windows and Linux (glibc and musl libc).](https://github.com/oznu/node-pty-prebuilt-multiarch)

3. [å¦‚ä½•åœ¨electronä¸­ç¼–è¯‘æ‰“åŒ…serialport](https://zhuanlan.zhihu.com/p/359776174)

## ç¼–è¯‘ mips64ç‰ˆæœ¬çš„ NodeJs

> [é¾™èŠ¯ï¼ˆmips64ï¼‰ç”µè„‘å®‰è£…NodeJS - æµ·è§’åœ¨çœ¼å‰ - åšå®¢å›­](https://www.cnblogs.com/lovesong/p/11589813.html)
> PS: åç»­é—®é¢˜: ä¸€å¼€å§‹æ²¡æœ‰å‘ç°14.16.1çš„NodeJsä¸­çš„NPMå­˜åœ¨é—®é¢˜(npm æ— æ³•è¿›è¡Œä¸‹è½½)

### ç¼–è¯‘æˆ v14.16.1

1. ä¸‹è½½[v14.16.1 æºä»£ç ](https://nodejs.org/download/release/v14.16.1/node-v14.16.1.tar.gz)

2. è¿›è¡Œé»˜è®¤é…ç½®
   
   > [Linux å‘½ä»¤è¯¦è§£ï¼ˆä¸‰ï¼‰./configureã€makeã€make install å‘½ä»¤ - Tinywan - åšå®¢å›­](https://www.cnblogs.com/tinywan/p/7230039.html)
   
   ```
   ./configure
   ```

3. å¼€å§‹ç¼–è¯‘
   
   ```
   make
   ```
   
   > è®°å¾—è¿›å…¥out/Releaseï¼Œè¿è¡Œ`./node -v`
   > è¿è¡ŒæˆåŠŸï¼Œå°±å¯ä»¥å¼€å§‹å®‰è£…äº†

4. å®‰è£…
   
   ```
   make install
   ```
   
   > å¤šåŠè¦åŠ sudo

5. æµ‹è¯•`node -v`
   
   > è®°å¾—åˆ‡ä¸€ä¸‹ç»ˆç«¯(é¾™èŠ¯ç³»ç»Ÿçš„ç»ˆç«¯å’Œwindowçš„å‘½ä»¤è¡Œä¸€æ ·ä¸å…·å¤‡å®æ—¶åˆ·æ–°ç¯å¢ƒå˜é‡çš„åŠŸèƒ½)
   
   ```
   $ node -v
   v14.16.1
   ```
   
   > æˆåŠŸ

## ç¼–è¯‘ ctags

æ—§ï¼š[Exuberant Ctags](http://ctags.sourceforge.net/)

> è¿™ä¸ªè²Œä¼¼æœ‰é—®é¢˜

æ–°ï¼š[Home Â· Universal Ctags](https://ctags.io/)
[GitHub - universal-ctags/ctags: A maintained ctags implementation](https://github.com/universal-ctags/ctags)

### ä¸‹è½½æºç 

æºç ä»“åº“ï¼š[Exuberant Ctags download | SourceForge.net](https://sourceforge.net/projects/ctags/)
ä¸‹è½½æºç ï¼š[Exuberant Ctags download | SourceForge.net](https://udomain.dl.sourceforge.net/project/ctags/ctags/5.8/ctags-5.8.tar.gz)

> è¿™ä¸ªè²Œä¼¼æœ‰é—®é¢˜

> æ”¹æˆé€šè¿‡Gitä¸‹è½½(æ–¹æ³•å¦‚ä¸‹...)

### å‰©ä½™éƒ¨åˆ†å¦‚nodeç¼–è¯‘

æ—§ï¼šä¸è¿‡ç¼–è¯‘å®Œæˆåï¼Œå°±ä¸ç”¨å®‰è£…å¹¶ä¸”ctagsåœ¨æ ¹ç›®å½•(æºç ç›®å½•)
æ–°ï¼š

```
$ git clone https://github.com/universal-ctags/ctags.git
$ cd ctags
$ ./autogen.sh
$ ./configure --prefix=/where/you/want # defaults to /usr/local
$ make
$ make install # may require extra privileges depending on where to install
```

## [TOP] å¤åˆ¶

### 0. å¤åˆ¶ä¸€ä»½asm

> æœ‰å¾ˆå¤šåº“æ˜¯ç›´æ¥å¼•ç”¨`#include <asm/errno.h>`
> ä½†æ˜¯åœ¨`/usr/include`ä¸‹å¹¶ä¸å­˜åœ¨`asm`
> æ‰€ä»¥å°±ä¼šå¼•ç”¨å¤±è´¥
> å³è€Œå°±è¦ä¿®æ”¹`#include <asm/errno.h>`ä¸º`#include <mips64el-linux-gnuabi64/asm/errno.h>`
> è¿™æ ·å¾ˆéº»çƒ¦
> æ‰€ä»¥ç›´æ¥Copyä¸€ä»½ä¸å°±å¥½äº†å˜›

```
cd /usr/include
sudo cp mips64el-linux-gnuabi64/asm ./asm -rf
```

### 1. å¤åˆ¶ ESP-IDF (MindPlusçš„ESP32ç³»åˆ—ä¸»æ¿)

> åç»­ç»“è®ºï¼Œæ˜¯é”™çš„

```
/home/loongson/arduino-toolkits/xtensa-esp32-elf -->  /home/loongson/æ¡Œé¢/mindPlus /Arduino/hardware/tools/mpython/xtensa-esp32-elf
```

### 2. å¤åˆ¶ nRF5 (MindPlusçš„micro:bitç³»åˆ—ä¸»æ¿)

> åç»­ç»“è®ºï¼Œæ˜¯é”™çš„

```
/home/loongson/arduino-toolkits/arm-none-eabi --> /home/loongson/æ¡Œé¢/mindPlus /Arduino/hardware/tools/nRF5/gcc-arm-none-eabi
```

> ps. è®°å¾—åˆ å‡åˆ° arm-none-eabiã€binã€libã€libexecä¸‰ä¸ªæ–‡ä»¶å¤¹

### 3. å¤åˆ¶ Arduino-builder

```
/home/loongson/arduino-toolkits/arduino-bin/arduino-builder --> /home/loongson/æ¡Œé¢/mindPlus /Arduino/arduino-builder/arduino-builder
```

> ps. è¿˜å·®ä¸€ä¸ªctags

### 4. å¤åˆ¶ avr

...

### 4.5 å¤åˆ¶ avrdude

> Version 6.3-20210108
> /home/loongson/.arduino15/packages/arduino/tools/avrdude/6.3.0-arduino17/bin/avrdude --> /home/loongson/æ¡Œé¢/mindPlus /Arduino/hardware/tools/avr/bin

### [åç»­1] 5 ç¦»çº¿å®‰è£…Electron

> ç”±äºæ‰‹è´±å’Œè¿‡äºè‡ªä¿¡(å®‰è£…äº†NodeJs v14.16.1)çš„å…³ç³»
> [æ‰‹æŠŠæ‰‹ç¦»çº¿å®‰è£…electron](https://juejin.cn/post/7003249707216535565)
> electronåŒ…: [electron-v10.1.0-linux-mips64el](http://ftp.loongnix.cn/os/loongnix/1.0/electron/releases/mips/v10.1.0/electron-v10.1.0-linux-mips64el.zip)

## [TOP2] MindPlus\Arduino\offile.py

### microbit

1. å‘½ä»¤å‚æ•°é…ç½®ï¼šArduino/hardware/dfrobot/nRF5/platform.txt

2. åœ¨offile.pyä¸­æ·»åŠ ç›¸åº”çš„å‚æ•°
   ä¾‹å¦‚ï¼šfork/exec {runtime.tools.avrdude.path}/../../../../arduino-builder/ctags: no such file or directory
   
   > {runtime.tools.avrdude.path}æ²¡æœ‰ï¼Œå°±åœ¨offile.pyä¸­æ·»åŠ `-prefs=runtime.tools.avrdude.path=è¯¥å‚æ•°çš„å€¼`
   
   ### microbitV2

3. å‘½ä»¤å‚æ•°é…ç½®ï¼šArduino/hardware/dfrobot/nRF52/platform.txt

4. åœ¨offile.pyä¸­æ·»åŠ ç›¸åº”çš„å‚æ•°
   ä¾‹å¦‚ï¼šfork/exec {runtime.tools.avrdude.path}/../../../../arduino-builder/ctags: no such file or directory
   
   > {runtime.tools.avrdude.path}æ²¡æœ‰ï¼Œå°±åœ¨offile.pyä¸­æ·»åŠ `-prefs=runtime.tools.avrdude.path=è¯¥å‚æ•°çš„å€¼`
   
   ### å…³é”®è¯ï¼šruntime.tools.avrdude.path
   
   Arduino/hardware/platform.txt

~## ç¼–è¯‘ openocd~
~### ä¸‹è½½(æ‹‰å–)æºç ~
~```~
~git clone git://git.code.sf.net/p/openocd/code openocd~
~```~
~### è·å–ä¾èµ–~
~```~
~./bootstrap~
~```~
~### å¼€å§‹ç¼–è¯‘~

## openocd

é¾™èŠ¯å†…ç½®æœ‰

```
Open On-Chip Debugger 0.10.
```

## avr-g++

é¾™èŠ¯å†…ç½®æœ‰`gcc version 5.4.0 (GCC)`

> ä½†æ˜¯ç”¨èµ·æ¥ä¸€è¨€éš¾å°½
> åº†å¹¸ï¼Œæˆ‘å¥½åƒæ‰¾åˆ°ä»–ä»¬(é¾™èŠ¯)é€‚é…avrçš„æ–¹æ³•äº†(é‡æ–°ç¼–è¯‘äº†ä¸€ä¸ªarduino[?])
> 
> > è·¯å¾„ï¼š/root/.arduino15/packages/arduino/tools

0. å°†å¸å·åˆ‡æ¢æˆroot
   
   ```
   su root
   ```
   
   > ps. å¦‚æœå¿˜è®°å¯†ç ï¼Œå¯ä»¥ä½¿ç”¨`sudo passwd root`è¿›è¡Œé‡ç½®å¯†ç 

1. å°†arduinoå¤åˆ¶åˆ°æ¡Œé¢
   
   ```
   cp /root/.arduino15/packages/arduino/ /home/loongson/æ¡Œé¢/arduino -rf
   ```

2. ç„¶åå°†/home/loongson/æ¡Œé¢/arduino/toolsä¸‹çš„avrä¸€èµ·å¤åˆ¶åˆ°MindPlus/Arduino/

```
/home/loongson/.arduino15/packages/arduino/tools/avrdude/6.3.0-arduino17/bin/avrdude --> /home/loongson/æ¡Œé¢/mindPlus /Arduino/hardware/tools/avr/bin
```

# æµ‹è¯•(æŠ›å¼ƒ...)

## å®æ—¶æ¨¡å¼

### æ™®é€šå®æ—¶æ¨¡å¼(ä¸æ·»åŠ ä¸»æ¿)

æ­£å¸¸

### æ·»åŠ ä¸»æ¿

å¤±è´¥

#### ä¿®å¤è¿‡ç¨‹

## ä¸Šä¼ æ¨¡å¼

### AC

1. micro:bit çƒ§å½•ä¸å®Œå…¨æˆåŠŸ(æ— æ³•è‡ªåŠ¨æŒ‚è½½)
2. leonardo (ç¼–è¯‘å¤±è´¥...çƒ§å½•å·¥å…·å¾…ç¼–è¯‘ï¼Œç¼–è¯‘æˆåˆ™æˆã€ä¸æˆåˆ™æŠ›ç»™å¤§ä½¬)[~è¿™ä¸ªä¸ºå†…ç½®~ å·²ç»å°†å…¶å¤åˆ¶åˆ°äº†Arduino/hardware/tools/avr ]  [å…·ä½“å®ç°è¿‡ç¨‹](#avr-g++) >> (æ²¡æœ‰æƒé™æ‰“å¼€ä¸²å£)
3. Uno (æ²¡æœ‰æƒé™æ‰“å¼€ä¸²å£)
4. Nano (æ²¡æœ‰æƒé™æ‰“å¼€ä¸²å£)
5. æŒæ§æ¿(é“¾æ¥å¤±è´¥...å¯èƒ½æ˜¯ä¾èµ–åº“é“¾æ¥å¤±è´¥)
6. Mega2560 (æ²¡æœ‰æƒé™æ‰“å¼€ä¸²å£)

### MP

## Pythonæ¨¡å¼

> ä»¥æ–‡ä»¶å½¢å¼ä¿å­˜æµ‹è¯•ç»“æœ...
> å‘Šä¸€æ®µè½....

# åç»­ç»“è®º

## ESP32ç³»åˆ— ä¸»æ¿

```
xtensa-esp32-elf-g++ (crosstool-NG esp-2021r2) 8.4.0
Copyright (C) 2018 Free Software Foundation, Inc.
This is free software; see the source for copying conditions.  There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
```

ç¼–è¯‘å™¨ç‰ˆæœ¬(8.4.0)å¤ªæ–°äº†ï¼Œ æŒ‡å®š5.2.0

## Micro:bit

ç¼–è¯‘å™¨å­˜åœ¨å†²çª(ç¼–è¯‘å™¨ä¸æˆ‘ä»¬çš„åº“å­˜åœ¨å†²çª)

```
arm-none-eabi-g++ (crosstool-NG 1.24.0.498_5075e1f) 10.3.0
Copyright (C) 2020 Free Software Foundation, Inc.
This is free software; see the source for copying conditions.  There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
```

1. in function `_lseek` -->  multiple definition of `_lseek`
2. in function `_open` -->  multiple definition of `_open`
3. in function `_close` -->  multiple definition of `_close`
4. in function `_isatty` -->  multiple definition of `_isatty`

## é—®é¢˜(ç›®çš„)å·²æ˜ç¡®

### å°è¯•ç¼–è¯‘ESP32çš„ç¼–è¯‘å™¨

1. å…‹éš†crosstool-NG

```
git clone -b xtensa-1.22.x git://github.com/jcmvbkbc/crosstool-NG.git crosstool-NG-xtensa-1.22.x
```

2. å®‰è£…ä¾èµ– texinfo(ä¸»è¦æ˜¯ä¸ºäº†makeinfo) help2man

> [å®‰è£…texinfoçš„åŸå› ](https://blog.csdn.net/cw616729/article/details/107179809)

```
sudo apt-get install texinfo help2man
```

3. å®‰è£…ä¾èµ– libtool(libtool >= 1.5.26)

æœ€å¥½å°±æ˜¯libtool v1.5.26

> [libtoolæºä»£ç ](http://ftp.gnu.org/gnu/libtool/)

- å¸è½½libtool

```
sudo apt-get remove libtool
```

- ç¼–è¯‘å¹¶å®‰è£…

```
./configure && make && sudo make install
```

4. ç¼–è¯‘crosstool-NG

```
# æºä»£ç ä½¿ç”¨
./bootstrap && ./configure --prefix=`pwd` && make && make install
# æ³¨å†Œåˆ°ç”µè„‘ï¼Œç„¶åä½¿ç”¨
./bootstrap && ./configure && make && sudo make install
```

> æˆ‘è¿™é‡Œç”¨çš„æ˜¯ç¬¬ä¸€ç§æ–¹æ³•
> ps. ä¸€å®šè¦å®‰è£…ï¼Œè¿™æ ·ç¨‹åºè¿è¡Œæ‰€éœ€è¦çš„ä¾èµ–èµ„æºå°±å¯ä»¥æ”¾åˆ°æ­£ç¡®çš„ä½ç½®ä¸Šå»

5. åˆ‡æ¢æ‰“åŒ…ç¼–è¯‘çš„é…ç½®

```
./ct-ng xtensa-esp32-elf
```

6. å®‰è£…æ‰“åŒ…ä¾èµ–(æ‰‹åŠ¨) or è‡ªåŠ¨å®‰è£…æ‰“åŒ…ä¾èµ–
   
   > æ¨èè‡ªåŠ¨å®‰è£…æ‰“åŒ…ä¾èµ– + æ‰‹åŠ¨å®‰è£…æ‰“åŒ…ä¾èµ–
   > å³å…ˆ`./ct-ng build`ï¼Œç„¶åæŸ¥çœ‹`build.log`æŸ¥çœ‹ç¼–è¯‘æ—¥å¿—
   > ç„¶åå†å»ä¸‹è½½ç›¸åº”çš„åŒ…æ”¾åœ¨`[ct-ngç¨‹åºè·¯å¾„]/.build/tarballs`å³å¯
- ç›®å‰çš„è¯ï¼Œä¼šä¸‹è½½å¤±è´¥çš„åŒ…ï¼Œæˆ‘å·²æ”¾åœ¨æˆ‘å·¥ä½œç”µè„‘çš„Fç›˜/MindPluså…¼å®¹/MindPlus_Espç¼–è¯‘å™¨å…¼å®¹/crosstool-NGçš„ä¾èµ–(ä¹Ÿå¯ä»¥é€šè¿‡æˆ‘çš„ç”µè„‘IPè¿›è¡Œè®¿é—®æˆ‘çš„åˆ†äº«ç½‘ç›˜)

> ä»¥ä¸‹å°±æ˜¯æˆ‘åœ¨æ‰“åŒ…å®‰è£…ä¾èµ–æ—¶é‡åˆ°çš„å‡ ä¸ªæ— æ³•é€šè¿‡è‡ªåŠ¨å®‰è£…æ‰“åŒ…ä¾èµ–å®Œæˆä¸‹è½½çš„åŒ…

| åŒ…             | ä¸‹è½½åœ°å€                                                                                   |
| ------------- | -------------------------------------------------------------------------------------- |
| isl.tar.bz2   | [Index of /pub/gcc/infrastructure](https://gcc.gnu.org/pub/gcc/infrastructure/)        |
| expat.tar.bz2 | [Expat XML Parser download \| SourceForge.net](https://sourceforge.net/projects/expat) |
| newlib.tar.gz | [newlib ftp directory](https://sourceware.org/ftp/newlib/index.html)                   |

7. æœ€åï¼Œåœ¨æ‰“åŒ…çš„ç»“å°¾å¯èƒ½ä¼šå‡ºç°ä»¥ä¸‹é—®é¢˜
   Build failed in step "installing corss-gdb"
   æˆ‘çš„è§£å†³æ–¹æ³•æ˜¯ç¦ç”¨gdbè°ƒè¯•ï¼Œå³å°†`.config`ä¸­çš„`CT_DEBUG_gdb=y`ä¿®æ”¹ä»`CT_DEBUG_gdb=n`

> ç»“æœï¼š ç¼–è¯‘åº“æˆåŠŸã€ç¼–è¯‘å¹¶çƒ§å½•(åœ¨å±å¹•ä¸Šç¬¬ä¸€è¡Œæ˜¾ç¤ºMind+[æŒæ§æ¿])æˆåŠŸ

### å°è¯•ç¼–è¯‘Microbitçš„ç¼–è¯‘å™¨

> å¤±è´¥
> å±è”½Microbit

1. å…‹éš†crosstool-NG

```
git clone -git://github.com/crosstool-NG/crosstool-NG.git crosstool-NG-1.24.0
```

2. [å¯èƒ½] å®‰è£…ä¾èµ– texinfo(ä¸»è¦æ˜¯ä¸ºäº†makeinfo) help2man

> [å®‰è£…texinfoçš„åŸå› ](https://blog.csdn.net/cw616729/article/details/107179809)

```
sudo apt-get install texinfo help2man
```

3. [å¯èƒ½] å®‰è£…ä¾èµ– libtool(libtool >= 1.5.26)

æœ€å¥½å°±æ˜¯libtool v1.5.26

> [libtoolæºä»£ç ](http://ftp.gnu.org/gnu/libtool/)

- å¸è½½libtool

```
sudo apt-get remove libtool
```

- ç¼–è¯‘å¹¶å®‰è£…

```
./configure && make && sudo make install
```

4. ç¼–è¯‘crosstool-NG

```
# æºä»£ç ä½¿ç”¨
./bootstrap && ./configure --prefix=`pwd` && make && make install
# æ³¨å†Œåˆ°ç”µè„‘ï¼Œç„¶åä½¿ç”¨
./bootstrap && ./configure && make && sudo make install
```

> æˆ‘è¿™é‡Œç”¨çš„æ˜¯ç¬¬ä¸€ç§æ–¹æ³•
> ps. ä¸€å®šè¦å®‰è£…ï¼Œè¿™æ ·ç¨‹åºè¿è¡Œæ‰€éœ€è¦çš„ä¾èµ–èµ„æºå°±å¯ä»¥æ”¾åˆ°æ­£ç¡®çš„ä½ç½®ä¸Šå»

5. åˆ‡æ¢æ‰“åŒ…ç¼–è¯‘çš„é…ç½®

```
./ct-ng arm-unknown-eabi
```

6. æ›´æ”¹äº¤å‰ç¼–è¯‘å™¨å†…éƒ¨GCCç‰ˆæœ¬é…ç½®ã€äº¤å‰ç¼–è¯‘å™¨åç§°(éƒ¨åˆ†åç§°)

> æ‰“å¼€`.config`

```diff
- CT_THREADS="unknown"
+ CT_THREADS="none"
  ...
- CT_GCC_VERSION="8.3.0"
+ CT_GCC_VERSION="10.2.0"
```

7. å®‰è£…æ‰“åŒ…ä¾èµ–(æ‰‹åŠ¨) or è‡ªåŠ¨å®‰è£…æ‰“åŒ…ä¾èµ–

> æ¨èè‡ªåŠ¨å®‰è£…æ‰“åŒ…ä¾èµ– + æ‰‹åŠ¨å®‰è£…æ‰“åŒ…ä¾èµ–
> å³å…ˆ`./ct-ng build`ï¼Œç„¶åæŸ¥çœ‹`build.log`æŸ¥çœ‹ç¼–è¯‘æ—¥å¿—
> ç„¶åå†å»ä¸‹è½½ç›¸åº”çš„åŒ…æ”¾åœ¨`[ct-ngç¨‹åºè·¯å¾„]/.build/tarballs`å³å¯

- ç›®å‰çš„è¯ï¼Œä¼šä¸‹è½½å¤±è´¥çš„åŒ…ï¼Œæˆ‘å·²æ”¾åœ¨æˆ‘å·¥ä½œç”µè„‘çš„Fç›˜/MindPluså…¼å®¹/MindPlus_Espç¼–è¯‘å™¨å…¼å®¹/crosstool-NGçš„ä¾èµ–(ä¹Ÿå¯ä»¥é€šè¿‡æˆ‘çš„ç”µè„‘IPè¿›è¡Œè®¿é—®æˆ‘çš„åˆ†äº«ç½‘ç›˜)

> ä»¥ä¸‹å°±æ˜¯æˆ‘åœ¨æ‰“åŒ…å®‰è£…ä¾èµ–æ—¶é‡åˆ°çš„å‡ ä¸ªæ— æ³•é€šè¿‡è‡ªåŠ¨å®‰è£…æ‰“åŒ…ä¾èµ–å®Œæˆä¸‹è½½çš„åŒ…

| åŒ…             | ä¸‹è½½åœ°å€                                                                                   |
| ------------- | -------------------------------------------------------------------------------------- |
| isl.tar.bz2   | [Index of /pub/gcc/infrastructure](https://gcc.gnu.org/pub/gcc/infrastructure/)        |
| expat.tar.bz2 | [Expat XML Parser download \| SourceForge.net](https://sourceforge.net/projects/expat) |
| newlib.tar.gz | [newlib ftp directory](https://sourceware.org/ftp/newlib/index.html)                   |

8. æœ€åè¿˜éœ€è¦æ·»åŠ ä¸€äº›åº“

> ç›®å‰ç¡®å®šä¸ºå±è”½Microbit

### å±è”½

1. å±è”½Microbit --> ç»™æç¤º

> è·¯å¾„: /home/loongson/desktop/mindPlus/src/components/scratch/extension-library/extension-library.jsx

```
            // mips64 å±è”½ microbit
            if (item.extensionURL == "microbit"){
                dfrobotAlert("æš‚ä¸æ”¯æŒ", "å½“å‰ç³»ç»Ÿç¼ºå°‘xx", 
                    {
                        cover: true,
                        btns: [
                            {text: Translate.translate(messagesAlert.yes), callBack:()=>{}},
                            {text: Translate.translate(messagesAlert.no)}
                        ]
                    }
                );
                return
            }
```

2. å±è”½leonardo

> è·¯å¾„: /home/loongson/desktop/mindPlus/src/lib/libraries/board-extensions/index.js
> æ³¨é‡Šæ‰ å³å¯

# æ‰“åŒ…

> [mips64ä¸‹electronæ‰“åŒ…](http://doc.loongnix.cn/web/#/818?page_id=4332)

## å®‰è£…

```
sudo npm install -g electron-packager
sudo npm install -g electron-installer-debian
```

## æ‰“æ•´åˆåŒ…

```
# electron-packager <sourcedir> <appname> --platform=<platform> --arch=<arch> [optional flags...]
electron-packager . mindPlus --platform linux --arch mips64el --out dist/
```

### é”™è¯¯

1. é”™è¯¯1ï¼š`WARNING: Official linux/mips64el support only exists in Electron ^1.8.2-beta.5`

è§£å†³æ–¹æ³•ï¼š

```
sudo gedit /usr/lib/node_modules/electron-packager/src/targets.js
å°† mips64el: '^1.8.2-beta.5'è¿™ä¸€è¡Œæ”¹ä¸ºmips64el: '10.1.0'
æ”¹å®Œåå¦‚ä¸‹ï¼š
linux: {
    arm64: '>= 1.8.0',
    //mips64el: '^1.8.2-beta.5'
    mips64el: '10.1.0'
  },
```

2. é”™è¯¯2ï¼š`connect ETIMEDOUT 20.205.243.166:443`

è§£å†³æ–¹æ³•ï¼š

```
# ä¸‹è½½(å½“å‰electronä¸º10.1.0æ‰€ä»¥å°±è¦ä¸‹è½½electron-v10.1.0-linux-mips64el.zip)
wget http://ftp.loongnix.cn/os/loongnix/1.0/electron/releases/mips/v10.1.0/electron-v10.1.0-linux-mips64el.zip
# å¤åˆ¶ electron-v10.1.0-linux-mips64el.zip åˆ° home/loongson/.cache/electron/
cp -rf electron-v10.1.0-linux-mips64el.zip /home/loongson/.cache/electron/
# ç„¶åæŒ‡å®šelectronåŒ…è·¯å¾„
electron-packager . mindPlus --platform linux --arch mips64el --out ./scratch/ --electron-zip-dir=/home/loongson/.cache/electron/
```

## æ‰“æˆdebåŒ…

```
bash ./compat/pack/afterSign.sh && electron-installer-debian --src ./scratch/mindPlus-linux-mips64el/ --arch mips64el --config config.json
```

## è¡¥å…¨

### æ·»åŠ Mime(æ•ˆæœç”šå¾®ï¼Œå‡ ä¹æ²¡æœ‰æ•ˆæœ)

> ç”±äºelectron-packageræ²¡æœ‰æä¾›mimeçš„é€‰é¡¹ï¼Œåªæœ‰ä¸€ä¸ªmimeType(ç»‘å®šå·²æœ‰æ–‡ä»¶ç±»å‹)
> ä½†æ˜¯sb3å±äºæœªçŸ¥æ–‡ä»¶ç±»å‹ï¼Œæ‰€ä»¥éœ€è¦è¡¥å…¨

1. å°† compat/after-install.sh å¤åˆ¶åˆ° compat/mips64/after-install.sh
2. ç„¶ååœ¨ compat/mips64/after-install.sh æœ«å°¾æ·»åŠ ä¸Š

```
# åˆ›å»ºMIMEæ–‡ä»¶
# ç”±äº electron-installer-debian æ²¡æœ‰ç”ŸæˆMIME
if [ ! -f /usr/share/mime/packages/mindplus.xml ];then
    sudo touch /usr/share/mime/packages/mindplus.xml
    cat >> /usr/share/mime/packages/mindplus.xml <<EOF
<?xml version="1.0" encoding="utf-8"?>
<mime-info xmlns="http://www.freedesktop.org/standards/shared-mime-info">
<mime-type type="application/x-mindplus">
  <glob pattern="*.sb3"/>

  <icon name="x-office-document" />
</mime-type>
</mime-info>
EOF
fi
```

## æ·»åŠ æ¡Œé¢å›¾æ ‡

### 1. è·å–æ¡Œé¢è·¯å¾„

```
desk=`cat $HOME/.config/user-dirs.dirs | grep DESKTOP | tail  -1  |cut -d '=' -f 2  | sed 's/\"//g'`
var=`eval echo $desk`
```

### 2. å¤åˆ¶(å¹¶ä¸é è°±)

```
cp /usr/share/applications/mindplus.desktop $var/mindplus.desktop
```

### 2. å†™å…¥(ä¹Ÿæ²¡æˆåŠŸ)

```
cat >> $var/mindplus.desktop <<EOF
[Desktop Entry]
Name=MindPlus
Comment=MindPluså¯ä»¥è½»æ¾åœ°åˆ›å»ºå¯è§†åŒ–æ•…äº‹æˆ–æ¸¸æˆä¸ç¼–ç å—ã€‚é€šè¿‡ä¸ºArduinoï¼ŒMicro:Bitå’Œå…¶ä»–å¾®æ§åˆ¶å™¨æ·»åŠ æ”¯æŒï¼Œæ‚¨ç”šè‡³å¯ä»¥å»ºç«‹ä¸€ä¸ªä¸ç°å®ç”Ÿæ´»ä¸­çš„äº’åŠ¨çš„æœ‰è¶£é¡¹ç›®ã€‚MindPlusè¿˜é™„å¸¦ä¸€ä¸ªåœ¨å—ä¸­çš„æ„å»ºè§£é‡Šå™¨ï¼Œå°†å—è½¬æ¢ä¸ºPythonæˆ–Cè¯­è¨€ã€‚
GenericName=MindPlus
Exec=mindplus %U
Icon=mindplus
Type=Application
StartupNotify=true
Categories=Utility;
MimeType=application/x-mindplus;
EOF
```

### 3. èµ‹äºˆå¯æ‰§è¡Œæƒé™

```
chmod +x $var/mindplus.desktop
```

# æœªå®Œé¡¹

1. æ³¨å†Œmime -> /usr/share/mime/packages
2. åˆ›å»ºæ¡Œé¢æ–‡ä»¶.desktop --> [æ·»åŠ æ¡Œé¢å›¾æ ‡](## æ·»åŠ æ¡Œé¢å›¾æ ‡)
3. èœå•æ å›¾æ ‡

# æ‚é¡¹

## æ‰¹é‡ä¿®æ”¹`require("fs/promises")` --> `require("fs").promises`

```
grep -rl 'require("fs/promises")' ./ | xargs sed -i 's/("fs\/promises")/\("fs"\).promises/g'
```

## è°ƒè¯•

> åœ¨ ç¨‹åºè·¯å¾„ ä¸­æ·»åŠ  `DfrobotTest.txt`

```
touch DfrobotTest.txt
```

> ç„¶å

```
Ctrl+Shift+D
```

> å‘¼å‡ºè°ƒè¯•çª—å£

## ä¿®æ”¹æ–‡ä»¶å¤¹çš„æ‰€å±

```
sudo chown -R ç”¨æˆ·å:ç”¨æˆ·å æ–‡ä»¶å¤¹/
```

## DeianåŒ…çš„ç”Ÿå‘½å‘¨æœŸ

è¿™äº›æ˜¯è½¯ä»¶åŒ…å®‰è£…å‰åè‡ªåŠ¨è¿è¡Œçš„å¯æ‰§è¡Œè„šæœ¬. ç»Ÿç§°ä¸ºæ§åˆ¶æ–‡ä»¶, æ˜¯ Deian è½¯ä»¶åŒ…çš„"æ§åˆ¶"éƒ¨åˆ†å®ƒä»¬æ˜¯ï¼š

### preinst å®‰è£…å‰

Debianè½¯ä»¶åŒ…(".deb")è§£å‹å‰æ‰§è¡Œçš„è„šæœ¬, ä¸ºæ­£åœ¨è¢«å‡çº§çš„åŒ…åœæ­¢ç›¸å…³æœåŠ¡,ç›´åˆ°å‡çº§æˆ–å®‰è£…å®Œæˆã€‚ (æˆåŠŸåæ‰§è¡Œ 'postinst' è„šæœ¬)ã€‚

### postinst å®‰è£…å®Œæˆå

ä¸»è¦å®Œæˆè½¯ä»¶åŒ…(".deb")å®‰è£…å®Œæˆåæ‰€éœ€çš„é…ç½®å·¥ä½œ. é€šå¸¸, postinst è„šæœ¬è¦æ±‚ç”¨æˆ·è¾“å…¥, å’Œ/æˆ–è­¦å‘Šç”¨æˆ·å¦‚æœæ¥å—é»˜è®¤å€¼, åº”è¯¥è®°å¾—æŒ‰è¦æ±‚è¿”å›é‡æ–°é…ç½®è¿™ä¸ªè½¯ä»¶ã€‚ ä¸€ä¸ªè½¯ä»¶åŒ…å®‰è£…æˆ–å‡çº§å®Œæˆåï¼Œpostinst è„šæœ¬é©±åŠ¨å‘½ä»¤, å¯åŠ¨æˆ–é‡èµ·ç›¸åº”çš„æœåŠ¡ã€‚

### prerm å¸è½½å‰

åœæ­¢ä¸€ä¸ªè½¯ä»¶åŒ…çš„ç›¸å…³è¿›ç¨‹, è¦å¸è½½è½¯ä»¶åŒ…çš„ç›¸å…³æ–‡ä»¶å‰æ‰§è¡Œã€‚

### postrm å¸è½½å

ä¿®æ”¹ç›¸å…³æ–‡ä»¶æˆ–è¿æ¥, å’Œ/æˆ–å¸è½½è½¯ä»¶åŒ…æ‰€åˆ›å»ºçš„æ–‡ä»¶ã€‚

### ç•ªå¤–

å½“å‰çš„æ‰€æœ‰é…ç½®æ–‡ä»¶éƒ½å¯åœ¨ /var/lib/dpkg/info ç›®å½•ä¸‹æ‰¾åˆ°, ä¸ foo è½¯ä»¶åŒ…ç›¸å…³çš„å‘½åä»¥ "foo" å¼€å¤´,ä»¥ "preinst", "postinst", ç­‰ä¸ºæ‰©å±•ã€‚è¿™ä¸ªç›®å½•ä¸‹çš„ foo.list æ–‡ä»¶åˆ—å‡ºäº†è½¯ä»¶åŒ…å®‰è£…çš„æ‰€æœ‰æ–‡ä»¶ã€‚Debiané‡Œç”¨apt-getå®‰è£…æˆ–å¸è½½è½¯ä»¶æ—¶ï¼Œä¼šå¸¸å‘ç”Ÿå‰å¤„ç†æˆ–åå¤„ç†çš„é”™è¯¯ï¼Œè¿™æ—¶åªè¦åˆ é™¤ å¯¹åº”çš„è„šæœ¬æ–‡ä»¶ï¼Œé‡æ–°æ‰§è¡Œå®‰è£…æˆ–å¸è½½å³å¯ã€‚

---

# ç¯å¢ƒ

## MindPlusç‰ˆæœ¬

- æ›´æ–°ç‰ˆæœ¬: V1.7.1RC2.0
- æ›´æ–°å¹³å°: é¾™èŠ¯

## åŸºç¡€å·¥å…·ç‰ˆæœ¬

- node: `v14.16.1`
- npm: `v6.14.12`
- git: `git version 2.20.1`
- electron:`6.1.7`(åŸ`10.1.0`)

> éœ€è¦å…¨å±€å®‰è£…çš„

- electron-packager
- electron-installer-debian
- asar

## ç³»ç»Ÿå†…æ ¸

```shell
Linux loongson-pc 4.19.0-13-loongson-3 #1 SMP Tue Aug 17 01:57:07 UTC 2021 mips64 GNU/Linux
```

# é‡ç½®å¤§æ³•

## é‡æ–°å®‰è£…ç³»ç»Ÿ

### 1. ä¸‹è½½ç³»ç»Ÿæ–‡ä»¶

åœ¨ [Index of /os/loongnix/20/mips64el/isos](http://ftp.loongnix.cn/os/loongnix/20/mips64el/isos/) ä¸­ä¸‹è½½é¾™èŠ¯mips64æ¶æ„çš„ç³»ç»Ÿ

è¿™ä¸¤ä¸ªisoæ–‡ä»¶éƒ½å¯ä»¥

### 2. åœ¨é¾™èŠ¯ç³»ç»Ÿä¸Šé¢çƒ§å½•åˆ°Uç›˜

```shell
dd if=é•œåƒæ–‡ä»¶åœ°å€  of=/devä¸‹è¯†åˆ«çš„Uç›˜è®¾å¤‡ bs=8M  &&  sync
```

ç³»ç»Ÿä¸‹è¯†åˆ«çš„Uç›˜è®¾å¤‡ï¼š /dev/sdb  (å¯é€šè¿‡fdisk -læˆ–è€…lsblkå‘½ä»¤æŸ¥çœ‹)

```shell
dd if=./Loongnix-20.mips64el.rc1.iso of=/dev/sdb1 bs=8M && sync
```

### 3. è¿›å…¥åˆ°BIOS, ç„¶åé€‰æ‹©Uç›˜å¯åŠ¨

å°±å¯ä»¥è¿›å…¥ç±»ä¼¼äºPEçš„æ¡Œé¢ï¼Œé€‰æ‹©â€œloongson å®‰è£…â€ï¼Œç„¶åè‡ªå·±åšä¸»ã€

[å®‰è£…æ­¥éª¤ Â· æ–‡æ¡£](http://docs.loongnix.cn/loongnix/lnd-20/loongarch64/Installation_Guide/05.%E5%AE%89%E8%A3%85%E6%AD%A5%E9%AA%A4.html)


## åˆ‡æ¢å†…æ ¸ç‰ˆæœ¬

### å®‰è£…å†…æ ¸

```shell
sudo apt install linux-headers-4.19.0-13-common=4.19.190-rc2.lnd.1 linux-headers-4.19.0-13-loongson-3=4.19.190-rc2.lnd.1 linux-headers-loongson-3=4.19.190-rc2.lnd.1 linux-image-4.19.0-13-loongson-3=4.19.190-rc2.lnd.1 linux-image-loongson-3=4.19.190-rc2.lnd.1 linux-kbuild-4.19=4.19.190-rc2.lnd.1 linux-libc-dev=4.19.190-rc2.lnd.1 linux-perf-4.19=4.19.190-rc2.lnd.1
```

### åˆ‡æ¢æ–¹æ³•â‘ : åœ¨grubç•Œé¢ä¸­åˆ‡æ¢

**æ­¥éª¤**

1. åœ¨grubç•Œé¢é€‰æ‹©`Advanced options for Loongnix 20 GNU/Linux`
2. ç„¶åé€‰æ‹©`Loongnix 20 GNU/Linux, with Linux 4.19.0-13-loongson-3`

> ç¼ºç‚¹: æ¯æ¬¡å¼€æœºéƒ½è¦åˆ‡æ¢ä¸€æ¬¡æ‰è¡Œ

### åˆ‡æ¢æ–¹æ³•â‘¡: ä¿®æ”¹grub.cfgæ–‡ä»¶å®ç°åˆ‡æ¢

**æ­¥éª¤**

1. ç¼–è¾‘`/boot/EFI/BOOT/grub.cfg`
2. æœç´¢`menuentry 'Loongnix 20 GNU/Linux' --class loongnix`

3. ç„¶åæ³¨é‡Šæ‰ä¸‹é¢çš„å†…å®¹`load_video --> boot`

    ```text
    menuentry 'Loongnix 20 GNU/Linux' --class loongnix --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-simple-64b682c8-5f61-4b24-a995-a419d52cc1ee' {
    	load_video
    	insmod gzio
    	if [ x$grub_platform = xxen ]; then insmod xzio; insmod lzopio; fi
    	insmod part_msdos
    	insmod ext2
    	set root='hd0,msdos1'
    	if [ x$feature_platform_search_hint = xy ]; then
    	  search --no-floppy --fs-uuid --set=root --hint-ieee1275='ieee1275//disk@0,msdos1' --hint-bios=hd0,msdos1 --hint-efi=hd0,msdos1 --hint-baremetal=ahci0,msdos1  0838bc69-5331-4792-904b-5a228b15ab27
    	else
    	  search --no-floppy --fs-uuid --set=root 0838bc69-5331-4792-904b-5a228b15ab27
    	fi
    	echo	'Loading Linux 4.19.167-rc4.lnd.3-loongson-3 ...'
    	linux	/vmlinuz-4.19.167-rc4.lnd.3-loongson-3 root=UUID=64b682c8-5f61-4b24-a995-a419d52cc1ee ro  quiet splash resume=UUID=e45e3944-c640-40a8-b982-68e21b047315
    	echo	'Loading initial ramdisk ...'
    	initrd	/initrd.img-4.19.167-rc4.lnd.3-loongson-3
    	boot
    }
    ```

4. ç„¶åå¤åˆ¶æƒ³è¦åˆ‡æ¢çš„å†…æ ¸çš„å†…å®¹`load_video --> boot`

      ```
         menuentry 'Loongnix 20 GNU/Linux, with Linux 4.19.0-13-loongson-3' --class loongnix --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-4.19.0-13-loongson-3-advanced-64b682c8-5f61-4b24-a995-a419d52cc1ee' {
         	load_video
         	insmod gzio
         	if [ x$grub_platform = xxen ]; then insmod xzio; insmod lzopio; fi
         	insmod part_msdos
         	insmod ext2
         	set root='hd0,msdos1'
         	if [ x$feature_platform_search_hint = xy ]; then
         	  search --no-floppy --fs-uuid --set=root --hint-ieee1275='ieee1275//disk@0,msdos1' --hint-bios=hd0,msdos1 --hint-efi=hd0,msdos1 --hint-baremetal=ahci0,msdos1  0838bc69-5331-4792-904b-5a228b15ab27
         	else
         	  search --no-floppy --fs-uuid --set=root 0838bc69-5331-4792-904b-5a228b15ab27
         	fi
         	echo	'Loading Linux 4.19.0-13-loongson-3 ...'
         	linux	/vmlinuz-4.19.0-13-loongson-3 root=UUID=64b682c8-5f61-4b24-a995-a419d52cc1ee ro  quiet splash resume=UUID=e45e3944-c640-40a8-b982-68e21b047315
         	echo	'Loading initial ramdisk ...'
         	initrd	/initrd.img-4.19.0-13-loongson-3
         	boot
         }
      ```

5. æœ€åæ›¿æ¢å³å¯

> ç¼ºç‚¹: å¤ªè¿‡ç¹ç


# ç¼–è¯‘SDK

- microbit
- microbitV2
- uno
- nano
- mega2560

## microbitç³»åˆ—

> è¯¥gcc-arm-none-eabiå·¥å…·ç›®å‰å·²ç»äº¤ç”±äº®å“¥ä¸å®˜æ–¹äº¤æ¶‰
> è¯¥å·¥å…·çš„ç¼–è¯‘(é€‚é…)å·²ä»**æˆ‘ä»¬è¿™è¾¹**è½¬åˆ°**å®˜æ–¹é‚£è¾¹**, è®©**å®˜æ–¹é‚£è¾¹**è¿›è¡Œé€‚é…

### microbit

#### é”™è¯¯â‘ : ç±»å‹åç§°IRCallbacké‡åäº†

è§£å†³æ–¹æ³•: å‚è€ƒmicrobitV2 - é”™è¯¯â‘¡: ç±»å‹åç§°IRCallbacké‡åäº†

> åæ­£å°±æ˜¯microbitå’ŒmicrobitV2çš„IRCallbacké‡åï¼Œä¿®æ”¹ä»»æ„ä¸€è¾¹çš„IRCallbackå°±å¯ä»¥è§£å†³

#### é”™è¯¯â‘¡: ç±»å‹åç§°IRCallbacké‡åäº†

### microbitV2

#### é”™è¯¯â‘ : arm-none-eabi-g++ è·¯å¾„é”™è¯¯

```shell
fork/exec /home/loongson/workspace/mindPlus2020-2021/Arduino/hardware/tools/avr/bin//../nRF5/gcc-arm-none-eabi/bin/arm-none-eabi-g++: no such file or directory
  [ERROR MICROBITV2] Compile failed!
```

è§£å†³æ–¹æ³•:

> Arduino/hardware/dfrobot/nRF52/platform.txt

```diff
- compiler.path={runtime.tools.avr-gcc.path}/../nRF5/gcc-arm-none-eabi/bin/
+ compiler.path={runtime.tools.avr-gcc.path}../../nRF5/gcc-arm-none-eabi/bin/
```

#### é”™è¯¯â‘¡: ç±»å‹åç§°IRCallbacké‡åäº†

```shell
In file included from /home/loongson/workspace/mindPlus2020-2021/Arduino/compile/sketch/main.ino:56:
 /home/loongson/workspace/mindPlus2020-2021/Arduino/libraries/DFRobot_MaqueenPlusV2/DFRobot_MaqueenPlusV2.h:8:16: error: conflicting declaration 'typedef void (* IRCallback)(int8_t)'
     8 | typedef void (*IRCallback)(int8_t val);
       |                ^~~~~~~~~~
 In file included from /home/loongson/workspace/mindPlus2020-2021/Arduino/libraries/DFRobot_MaqueenPlus/DFRobot_MaqueenPlus.h:6,
                  from /home/loongson/workspace/mindPlus2020-2021/Arduino/compile/sketch/main.ino:6:
 /home/loongson/workspace/mindPlus2020-2021/Arduino/libraries/DFRobot_IRremote/DFRobot_IRremote.h:21:16: note: previous declaration as 'typedef void (* IRCallback)(uint8_t)'
    21 | typedef void (*IRCallback)(uint8_t val);
       |                ^~~~~~~~~~
 exit status 1
  [ERROR MICROBITV2] Compile failed!
```

è§£å†³æ–¹æ³•:

> Arduino/libraries/DFRobot_MaqueenPlusV2/DFRobot_MaqueenPlusV2.cpp
>
> Arduino/libraries/DFRobot_MaqueenPlusV2/DFRobot_MaqueenPlusV2.h

å…¨å±€ä¿®æ”¹ `IRCallback` -> `IRCallbackV2`

#### ã€âŒã€‘é”™è¯¯â‘¢: æ²¡æœ‰æ‰¾åˆ°-lsupc++_nano

> å³ç¼ºå°‘ libsupc++_nano.so æ–‡ä»¶

```shell
/tmp/ccNq8aAs.s: Assembler messages:
 /tmp/ccNq8aAs.s:92: Warning: ignoring changed section attributes for .data
 /home/loongson/workspace/mindPlus2020-2021/Arduino/hardware/tools/nRF5/gcc-arm-none-eabi/bin/../lib/gcc/arm-none-eabi/10.3.0/../../../../arm-none-eabi/bin/ld: cannot find -lsupc++_nano
 collect2: error: ld returned 1 exit status
 exit status 1
  [ERROR MICROBITV2] Compile failed!
```

è§£å†³æ–¹æ³•:

1. æŸ¥çœ‹

   ```shell
   ld -lsupc++_nano --verbose
   ```

   ```text
   è¯•å›¾æ‰“å¼€ //usr/local/lib/mips64el-linux-gnuabi64/libsupc++_nano.so å¤±è´¥
   è¯•å›¾æ‰“å¼€ //usr/local/lib/mips64el-linux-gnuabi64/libsupc++_nano.a å¤±è´¥
   è¯•å›¾æ‰“å¼€ //lib/mips64el-linux-gnuabi64/libsupc++_nano.so å¤±è´¥
   è¯•å›¾æ‰“å¼€ //lib/mips64el-linux-gnuabi64/libsupc++_nano.a å¤±è´¥
   è¯•å›¾æ‰“å¼€ //usr/lib/mips64el-linux-gnuabi64/libsupc++_nano.so å¤±è´¥
   è¯•å›¾æ‰“å¼€ //usr/lib/mips64el-linux-gnuabi64/libsupc++_nano.a å¤±è´¥
   è¯•å›¾æ‰“å¼€ //usr/local/lib64/libsupc++_nano.so å¤±è´¥
   è¯•å›¾æ‰“å¼€ //usr/local/lib64/libsupc++_nano.a å¤±è´¥
   è¯•å›¾æ‰“å¼€ //lib64/libsupc++_nano.so å¤±è´¥
   è¯•å›¾æ‰“å¼€ //lib64/libsupc++_nano.a å¤±è´¥
   è¯•å›¾æ‰“å¼€ //usr/lib64/libsupc++_nano.so å¤±è´¥
   è¯•å›¾æ‰“å¼€ //usr/lib64/libsupc++_nano.a å¤±è´¥
   è¯•å›¾æ‰“å¼€ //usr/local/lib/libsupc++_nano.so å¤±è´¥
   è¯•å›¾æ‰“å¼€ //usr/local/lib/libsupc++_nano.a å¤±è´¥
   è¯•å›¾æ‰“å¼€ //lib/libsupc++_nano.so å¤±è´¥
   è¯•å›¾æ‰“å¼€ //lib/libsupc++_nano.a å¤±è´¥
   è¯•å›¾æ‰“å¼€ //usr/lib/libsupc++_nano.so å¤±è´¥
   è¯•å›¾æ‰“å¼€ //usr/lib/libsupc++_nano.a å¤±è´¥
   è¯•å›¾æ‰“å¼€ //usr/mips64el-linux-gnuabi64/lib64/libsupc++_nano.so å¤±è´¥
   è¯•å›¾æ‰“å¼€ //usr/mips64el-linux-gnuabi64/lib64/libsupc++_nano.a å¤±è´¥
   è¯•å›¾æ‰“å¼€ //usr/mips64el-linux-gnuabi64/lib/libsupc++_nano.so å¤±è´¥
   è¯•å›¾æ‰“å¼€ //usr/mips64el-linux-gnuabi64/lib/libsupc++_nano.a å¤±è´¥
   ld: æ‰¾ä¸åˆ° -lsupc++_nano
   ```

2. å¤åˆ¶åº“



arm-none-eabiç¼–è¯‘æ‰‹å†Œ(å¹¶ä¸æˆåŠŸ)

## UNOç³»åˆ—

### uno

#### é”™è¯¯â‘ : ç¼ºå°‘libfl.so.2

```shell
In file included from /home/loongson/workspace/mindPlus2020-2021/Arduino/libraries/DFRobot_SpeechSynthesis_M/DFRobot_SpeechSynthesis_M.h:20:0,
                  from /home/loongson/workspace/mindPlus2020-2021/Arduino/libraries/DFRobot_SpeechSynthesis_M/DFRobot_SpeechSynthesis_M.cpp:1:
 /home/loongson/workspace/mindPlus2020-2021/Arduino/hardware/arduino/avr/libraries/Wire/Wire.h: In member function 'virtual uint8_t DFRobot_Speech                                              Synthesis_I2C::readACK()':
 /home/loongson/workspace/mindPlus2020-2021/Arduino/hardware/arduino/avr/libraries/Wire/Wire.h:64:13: note: candidate 1: uint8_t TwoWire::requestF                                              rom(int, int)
      uint8_t requestFrom(int, int);
              ^~~~~~~~~~~
 /home/loongson/workspace/mindPlus2020-2021/Arduino/hardware/arduino/avr/libraries/Wire/Wire.h:61:13: note: candidate 2: uint8_t TwoWire::requestF                                              rom(uint8_t, uint8_t)
      uint8_t requestFrom(uint8_t, uint8_t);
              ^~~~~~~~~~~
 /home/loongson/workspace/mindPlus2020-2021/Arduino/hardware/tools/avr/bin/../lib/gcc/avr/7.3.0/../../../../avr/bin/ar: error while loading shared                                               libraries: libfl.so.2: cannot open shared object file: No such file or directory
 exit status 127
  [ERROR UNO] Compile failed!
```

è§£å†³æ–¹æ³•:

| æ–¹æ³•                                          | ç»“æœ |
| --------------------------------------------- | ---- |
| åˆ‡æ¢gcc 8 æ”¹æˆ gcc 7                          | âŒ    |
| å®‰è£…libfl2<br />`sudo apt-get install libfl2` | â­•    |

### nano

#### åŒä¸Šï¼Œä¸Šé¢è§£å†³åä¸‹é¢å°±éƒ½okäº†

### mega2560

#### åŒä¸Šä¸Š

# MindPlus æµ‹è¯•

## Python æ¨¡å¼

> ç®€å•æµ‹è¯•ï¼Œ å¹¶æ²¡æœ‰ä»€ä¹ˆé—®é¢˜

## Arduino æ¨¡å¼

> Leonardo å·²æ”¾å¼ƒæµ‹è¯•
> ç›®å‰é€‚é…çš„å›½äº§ä»˜è´¹Linux(Loongson\ç»Ÿä¿¡)éƒ½ä¼šå°† Leonardo çƒ§å

> ç®€å•æµ‹è¯•

| ä¸»æ¿     | AC  | MPY | æµ‹è¯•ç»“æœ | å¤‡æ³¨                      |
| -------- | --- | --- | -------- | ------------------------- |
| microbit |     |     |          | SDKæ²¡æœ‰ç¼–è¯‘æˆåŠŸï¼Œä¸åšæµ‹è¯• |
| UNO      | âœ”   |     | âœ”        |                           |
|          |     |     |          |                           |


## å®æ—¶æ¨¡å¼

| ä¸»æ¿              | æµ‹è¯•ç»“æœ | å¤‡æ³¨ |                            |
| ----------------- | -------- | ---- | -------------------------- |
| åŸºç¡€              | âœ”        |      |                            |
| ä¸»æ¿              |          |      | Arduino æ¨¡å¼æµ‹è¯•å®Œæˆåå†æµ‹ |
| å®æ—¶æ¨¡å¼ - å“ˆå£«å¥‡ | âŒ       |      | ä¹‹å‰é€‚é…æ—¶ï¼Œé”™è¯¯è¿‡çš„       |


### å“ˆå£«å¥‡çš„é”™è¯¯

#### ç§¯æœ¨ï¼šHuskyLens [æ‹ç…§] å¹¶ä¿å­˜åˆ°æœ¬åœ°æ–‡ä»¶å¤¹ [ğŸ’»]

åœ¨é€‰æ‹©æ–‡ä»¶å¤¹æ—¶ï¼Œé€‰æ‹©ç›®å½•åï¼Œç»“æœæ˜¾ç¤ºçš„å¹¶ä¸æ˜¯ç›®å½•è·¯å¾„ï¼Œè€Œæ˜¯ç›®å½•çš„å­ç›®å½•çš„å­ç›®å½•çš„æ–‡ä»¶çš„è·¯å¾„ï¼Œå…·ä½“å¦‚ä¸‹

é€‰ä¸­çš„æ–‡ä»¶å¤¹folderé‡Œé¢çš„å†…å®¹

```
folder  
â”œâ”€â”€ file1
â”œâ”€â”€ file2  
â””â”€â”€ file3
```

åŸæœ¬åº”å½“ä¸º `folder`, ç»“æœä¸º`folder\file1`

é€ æˆè¿™ä¸ªé—®é¢˜çš„åŸå› æ˜¯: [é‡å¤§å˜åŒ– | ç”µå­](https://www.electronjs.org/zh/docs/latest/breaking-changes#behavior-changed-webkitdirectory-attribute-for-input-typefile-now-lists-directory-contents)

> ç®€å•æ¥è¯´ï¼Œelectron ç‰ˆæœ¬ä¸è¶…è¿‡6å°±æ²¡æœ‰é—®é¢˜ï¼Œè¶…è¿‡çš„è¯å°±åº”è¯¥ä½¿ç”¨è¿™ä¸ªAPI([dialog | Electron](https://www.electronjs.org/zh/docs/latest/api/dialog#dialogshowopendialogbrowserwindow-options))æ¥å®ç°é€‰æ‹©æ–‡ä»¶å¤¹

> loongson Electron ä¸‹è½½åœ°å€: [Index of /os/loongnix/1.0/electron/releases/mips](http://ftp.loongnix.cn/os/loongnix/1.0/electron/releases/mips/)


# ä¿®å¤

##  ä¸ºäº†è§£å†³ å“ˆå£«å¥‡çš„é”™è¯¯ é™çº§electron

### é‡æ–°ç¼–è¯‘ serialport å’Œ node-pty

#### â‘  å®‰è£…electron-rebuild

> åŸæœ¬å°è¯•ä½¿ç”¨cnpmè¿›è¡Œä¸‹è½½
> 
> åœ¨ [ç»Ÿä¿¡ç³»ç»Ÿ+é¾™èŠ¯(loong64-3A5000)é€‚é…](ç»Ÿä¿¡ç³»ç»Ÿ+é¾™èŠ¯(loong64-3A5000)é€‚é….md) ä¸­é€šè¿‡`cnpm`å®‰è£…`electron-rebuild`æˆåŠŸ

```shell
sudo npm install -g cnpm
sudo cnpm install -g electron-rebuild
```

> æŠ¥é”™

```
TypeError: randomUUID is not a function
```

> åæ­£å°±è¯´ï¼Œcnpm ç‰ˆæœ¬å¤ªä½äº†
> 
> è§£å†³æ–¹æ³•: [cnpm æ–°ç‰ˆæœ¬æ›¿æ¢ï¼ŒåŠrandomUUID is not a functioné—®é¢˜è§£å†³_åŒä¸‹å·´å¤§åœ†è„¸çš„åšå®¢-CSDNåšå®¢_cnpmç‰ˆæœ¬](https://blog.csdn.net/yummry/article/details/125274754)

>ç„¶åå°è¯•ä½¿ç”¨yarnè¿›è¡Œå®‰è£…

```shell
sudo npm install -g yarn
sudo yarn global add electron-rebuild
```

> ç„¶åå°±å®‰è£…æˆåŠŸäº†

#### â‘¡ å¼€å§‹é€‚é…

```shell
cd ./compat/mips64/serialport/node_modules/@serialport/bindings
# electron-rebuildè·¯å¾„ -v electronç‰ˆæœ¬ -a æ¶æ„
electron-rebuild -v 6.1.7 -a mips64
```

```shell
cd ./compat/mips64/node-pty-prebuilt-multiarch
# electron-rebuildè·¯å¾„ -v electronç‰ˆæœ¬ -a æ¶æ„
electron-rebuild -v 6.1.7 -a mips64
```

> åªè¦å‡ºç°äº†ä¸‹é¢çš„å†…å®¹ï¼Œå°±è¯´æ˜ç¼–è¯‘æˆåŠŸ

```
âœ” Rebuild Complete
```

### å­˜åœ¨ä¸²å£æ¥æ”¶æ•°æ®é‡ä¸å¤Ÿ

ç±»ä¼¼äº [ç¦…é“5815](http://test.dfrobot.top:5000/zentao/bug-view-5815.html) çš„æƒ…å†µ

#### å¦‚ä½•æŸ¥çœ‹

otherModules\scratch-vm\src\modules\huskyLensPro.js

æœç´¢ `this._device.transport.on("data"`

```diff
  this._device.transport.on("data", data => {
      if (this.readByteLength) {
          this.readByteLength.buffer = this.readByteLength.buffer.concat(JSON.parse(JSON.stringify(data)).data);
+         console.log("length==", this.readByteLength.buffer.length)
          if (this.readByteLength.buffer.length >= this.readByteLength.length) {
              // if(this._debug) console.log("æ¥æ”¶==", this.readByteLength.buffer);
              this.emit('readByteLength');
          }
      } else {
          if (this._debug) console.log("æ¥æ”¶==", JSON.parse(JSON.stringify(data)).data);
          this.receiveCallback(JSON.parse(JSON.stringify(data)).data);
      }
  });
```

#### å±è”½

åœ¨ç§¯æœ¨ä¸Šæ·»åŠ 

```
disanled: true
```

å°±å¯ä»¥å®ç°å±è”½ç§¯æœ¨(ç§¯æœ¨å˜ç°)

# æ‰“åŒ…

ç›®å‰é‡‡ç”¨çš„æ‰“åŒ…æ–¹å¼ä¸º`electron-packager`å’Œ`electron-installer-debian`ï¼Œä½†æ˜¯éƒ½è¿˜éœ€è¦è¿›è¡Œä¿®æ”¹åæ‰èƒ½å¼€å§‹æ‰“åŒ…(æ˜æ˜å»å¹´é€‚é…æ—¶éƒ½ä¸ç”¨)

## ä¿®æ”¹

### electron-packager å…è®¸ç¼–è¯‘çš„ç‰ˆæœ¬

>ç”±äºæˆ‘æ˜¯ç”¨NPMè¿›è¡Œå…¨å±€å®‰è£…çš„
>æ‰€ä»¥electron-packagerè·¯å¾„ä¸º: `/usr/local/share/.config/yarn/global/node_modules/electron-packager`

> ä¿®æ”¹`/usr/local/share/.config/yarn/global/node_modules/electron-packager/src/targets.js`

```diff
  const buildVersions = {
    darwin: {
      arm64: '>= 11.0.0-beta.1',
      universal: '>= 11.0.0-beta.1'
    },
    linux: {
      arm64: '>= 1.8.0',
-     mips64el: '^1.8.2-beta.5'
+     mips64el: '>=1.8.2-beta.5'
    },
    mas: {
      arm64: '>= 11.0.0-beta.1',
      universal: '>= 11.0.0-beta.1'
    },
    win32: {
      arm64: '>= 6.0.8'
    }
  }
```

### electron-installer-debian ä»£ç : TypeError: Invalid Version:

> è§£å†³æ–¹æ³•å‚è€ƒ: [æ— æ³•ä½¿ç”¨ Electron 4 beta æ­£ç¡®è¯»å– Electron ç‰ˆæœ¬ Â· é—®é¢˜ #152 Â· electron-userland/electron-installer-debian](https://github.com/electron-userland/electron-installer-debian/issues/152)

> ç”±äºæˆ‘æ˜¯ç”¨YARNè¿›è¡Œå…¨å±€å®‰è£…çš„
> æ‰€ä»¥electron-installer-debianè·¯å¾„ä¸º: `/usr/local/share/.config/yarn/global/node_modules/electron-installer-debian`

> ã€å¯åšå¯ä¸åšã€‘ä¿®æ”¹`/usr/local/share/.config/yarn/global/node_modules/electron-installer-common/src/`æ–‡ä»¶

```diff
  module.exports = async function readElectronVersion (appDir) {
+   console.log("æ­£åœ¨é€šè¿‡è¯»å–æ–‡ä»¶æ¥è·å–electronç‰ˆæœ¬", path.resolve(appDir, 'version'))
    const tag = await fs.readFile(path.resolve(appDir, 'version'))
+   console.log("electronç‰ˆæœ¬ä¸º", tag.toString().trim())
    return tag.toString().trim()
  }
```

> ä¿®æ”¹`/home/loongson/workspace/mindPlus2020-2021/scratch/mindPlus-linux-mips64el/version`
>
> `/home/loongson/workspace/mindPlus2020-2021`æ˜¯mind+é€‚é…çš„æœ¬åœ°ä»“åº“è·¯å¾„
>
> ps: å¦‚æœä¿®æ”¹äº†ä¸Šé¢é‚£ä¸ªï¼Œå°±å¯ä»¥æ›´å¿«çŸ¥é“è¦ä¿®æ”¹é‚£ä¸ªæ–‡ä»¶

```
6.1.7
```

> è¿™é‡Œå¡«å†™ä½ æ‰“åŒ…æ—¶electronçš„ç‰ˆæœ¬å·ï¼Œä¸è¦å¸¦v
> ps. è¿™ä¸ªé—®é¢˜æˆ‘æ€€ç–‘æ˜¯é¾™èŠ¯é€‚é…electronæ—¶ï¼Œå¹¶æ²¡æœ‰åœ¨versionæ–‡ä»¶é‡Œé¢å¡«å†™ç‰ˆæœ¬ä¿¡æ¯
> > äº‹å®ä¸Šï¼Œæˆ‘æŸ¥çœ‹åå‘ç°versionæ–‡ä»¶ç¡®å®æ²¡æœ‰å¡«å†™ç‰ˆæœ¬ä¿¡æ¯
> > å¯¼è‡´`electron-packager`ç›´æ¥å¤åˆ¶electronåŒ…é‡Œé¢çš„versionæ–‡ä»¶ï¼Œå¯¼è‡´`electron-installer-debian`ç¼–è¯‘æ—¶æŠ¥è¿™ä¸ªé”™

## æ‰“åŒ…åçš„electronèœå•æ ä¾æ—§å­˜åœ¨ï¼Œä½†æ˜¯ç‚¹å‡»ä¼šå¯¼è‡´ç¨‹åºå´©æºƒ

é€šè¿‡ä¸‹è¿°ä»£ç å®ç°electronèœå•æ éšè—

```js
Menu.setApplicationMenu(null);
// è®¾ç½®èœå•çš„é€‰é¡¹ä¸ºnull
```

åœ¨`loongson 3A4000 + electron 6.1.7`ä¸Šå¹¶ä¸å®Œå…¨å®ç°electronèœå•æ éšè—(åœ¨å…¶ä½™linuxä¸Šå¹¶æœªå‘ç°é—®é¢˜ã€**å¯èƒ½æ˜¯electronç‰ˆæœ¬çš„å…³ç³»å§**)

> èœå•æ åŠŸèƒ½å¤±æ•ˆã€ä½†æ˜¯èœå•æ å¹¶æœªéšè—

é€šè¿‡æŸ¥è¯¢åï¼Œå†³å®šé‡‡ç”¨è¿™ç§æ–¹å¼å®ç°**èœå•æ åŠŸèƒ½å¤±æ•ˆ**+**èœå•æ éšè—**

```diff
 const startMainWindow = (callback) => {
 
     mainWindow = new BrowserWindow({
         width: 1400,
         height: 900,
         show: false,
+        autoHideMenuBar: app.isPackaged,
         webPreferences: {
             nodeIntegrationInWorker: true
         }
     });
 
     if (app.isPackaged) {
         // çœç•¥
-        DEF_Linux && Menu.setApplicationMenu(null);
+        DEF_Linux && Menu.setApplicationMenu(Menu.buildFromTemplate([]));
     } else {
         // Menu.setApplicationMenu(null);
         mainWindow.webContents.openDevTools();
     }
```

